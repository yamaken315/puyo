{"mappings":"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","sources":["index.ts"],"sourcesContent":["class Puyo {\n  color: string;\n  x: number;\n  y: number;\n  isFixed: boolean;\n\n  constructor(color: string, x: number, y: number) {\n    this.color = color;\n    this.x = x;\n    this.y = y;\n    this.isFixed = false;\n  }\n\n  drop() {\n    this.y += 1;\n  }\n\n  draw(ctx: CanvasRenderingContext2D, blockSize: number) {\n    ctx.fillStyle = this.color;\n    ctx.beginPath();\n    ctx.arc(\n      this.x * blockSize + blockSize / 2, // x of center\n      this.y * blockSize + blockSize / 2, // y of center\n      (blockSize / 2) * 0.9, // radius of circle (smaller than block)\n      0, // draw from 0 rad\n      Math.PI * 2 // draw to 2PI rad (360 degree)\n    );\n    ctx.closePath();\n    ctx.fill();\n  }\n}\n\nclass ActivePuyoPair {\n  puyo1: Puyo; // 親ぷよ\n  puyo2: Puyo; // 子ぷよ\n\n  constructor(puyo1: Puyo, puyo2: Puyo) {\n    this.puyo1 = puyo1;\n    this.puyo2 = puyo2;\n  }\n\n  drop() {\n    this.puyo1.drop();\n    this.puyo2.drop();\n  }\n\n  draw(ctx: CanvasRenderingContext2D, blockSize: number) {\n    this.puyo1.draw(ctx, blockSize);\n    this.puyo2.draw(ctx, blockSize);\n  }\n\n  moveHorizontal(direction: number) {\n    this.puyo1.x += direction;\n    this.puyo2.x += direction;\n  }\n\n  rotateRight() {\n    const dx = this.puyo2.x - this.puyo1.x;\n    const dy = this.puyo2.y - this.puyo1.y;\n    this.puyo2.x = this.puyo1.x - dy;\n    this.puyo2.y = this.puyo1.y + dx;\n    if (!this.isPositionValid(this.puyo2.x, this.puyo2.y)) {\n      // 元に戻す\n      this.puyo2.x = this.puyo1.x + dy;\n      this.puyo2.y = this.puyo1.y - dx;\n    }\n  }\n\n  rotateLeft() {\n    const dx = this.puyo2.x - this.puyo1.x;\n    const dy = this.puyo2.y - this.puyo1.y;\n    this.puyo2.x = this.puyo1.x + dy;\n    this.puyo2.y = this.puyo1.y - dx;\n    if (!this.isPositionValid(this.puyo2.x, this.puyo2.y)) {\n      // 元に戻す\n      this.puyo2.x = this.puyo1.x - dy;\n      this.puyo2.y = this.puyo1.y + dx;\n    }\n  }\n\n  isPositionValid(x: number, y: number): boolean {\n    if (x < 0 || x >= fieldWidth || y >= fieldHeight) {\n      return false; // out of bounds\n    }\n    if (y < 0) {\n      return true; // 上部は許容\n    }\n    if (fieldState[y][x] !== 0) {\n      return false; // 既に存在する\n    }\n    return true;\n  }\n}\n\nfunction generatePuyo(): Puyo {\n  const color = generateRandomColor();\n  return new Puyo(color, 0, 0); // 初期位置を設定\n}\n\nfunction generatePuyoPair(): ActivePuyoPair {\n  const puyo1 = new Puyo(generateRandomColor(), 2, 0);\n  const puyo2 = new Puyo(generateRandomColor(), 2, 1);\n  return new ActivePuyoPair(puyo1, puyo2);\n}\n\nfunction generateNewPuyoPair() {\n  currentPuyoPair = generatePuyoPair();\n}\n\nconst canvas = document.getElementById(\"canvas\") as HTMLCanvasElement;\nconst ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\nconst fieldWidth = 6;\nconst fieldHeight = 12;\nconst blockSize = 30;\n//change size of canvas to fit the field\ncanvas.width = fieldWidth * blockSize;\ncanvas.height = fieldHeight * blockSize;\n\nlet currentPuyoPair: ActivePuyoPair | null = null;\n\nconst fieldState: number[][] = []; //state of field\nfor (let y = 0; y < fieldHeight; y++) {\n  fieldState[y] = [];\n  for (let x = 0; x < fieldWidth; x++) {\n    fieldState[y][x] = 0;\n  }\n}\n\nfunction drawField() {\n  ctx.clearRect(0, 0, canvas.width, canvas.height); //clear the canvas\n  //draw grid lines\n\n  ctx.strokeStyle = \"lightgray\";\n  ctx.lineWidth = 0.5;\n  for (let x = 0; x <= fieldWidth; x++) {\n    ctx.beginPath();\n    ctx.moveTo(x * blockSize, 0);\n    ctx.lineTo(x * blockSize, canvas.height);\n    ctx.stroke();\n  }\n  for (let y = 0; y <= fieldHeight; y++) {\n    ctx.beginPath();\n    ctx.moveTo(0, y * blockSize);\n    ctx.lineTo(canvas.width, y * blockSize);\n    ctx.stroke();\n  }\n\n  // Ensure currentPuyoPair is generated\n  if (!currentPuyoPair) {\n    generateNewPuyoPair();\n  }\n\n  // Draw puyoPair in operation\n  currentPuyoPair!.draw(ctx, blockSize);\n}\n\ngenerateNewPuyoPair();\ndrawField();\ndocument.addEventListener(\"keydown\", handleKeyDown);\n\n//ランダムな色を生成する関数を作成\nfunction generateRandomColor(): string {\n  const colors = [\"red\", \"blue\", \"green\", \"yellow\", \"purple\"];\n  const randomIndex = Math.floor(Math.random() * colors.length); //0 <= x < colors.length までの数値を小数点切り捨てする\n  return colors[randomIndex];\n}\n\nfunction handleKeyDown(event: KeyboardEvent) {\n  if (!currentPuyoPair) return;\n  switch (event.key) {\n    case \"ArrowLeft\":\n      currentPuyoPair.moveHorizontal(-1);\n      break;\n    case \"ArrowRight\":\n      currentPuyoPair.moveHorizontal(1);\n      break;\n    case \"ArrowDown\":\n      currentPuyoPair.drop();\n      break;\n    case \"c\":\n      currentPuyoPair.rotateRight();\n      break;\n    case \"x\":\n      currentPuyoPair.rotateLeft();\n      break;\n  }\n  console.log(\"keyDown(\" + event.key + \")\");\n  console.log(\n    \"ActivePuyoPair(x1, y1, x2, y2):\",\n    currentPuyoPair.puyo1.x,\n    currentPuyoPair.puyo1.y,\n    currentPuyoPair.puyo2.x,\n    currentPuyoPair.puyo2.y\n  );\n  drawField();\n}\n"],"names":[],"version":3,"file":"index.242b51c6.js.map","sourceRoot":"/__parcel_source_root/"}